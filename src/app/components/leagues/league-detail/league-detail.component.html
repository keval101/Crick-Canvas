<div>

  <div class="mb-8" *ngIf="finalMatch?.status === 'completed'">
    <app-league-winner [match]="finalMatch"></app-league-winner>
  </div>
  
  <div class="hero-bg w-full relative rounded-md">
    <div class="absolute inset-0 bg-gradient-to-r from-black/80 to-transparent rounded-md"></div>
    <div class="max-w-7xl mx-auto h-full flex items-center relative px-8">
      <div class="text-white max-w-2xl">
        <h1 class="text-5xl font-bold mb-6">{{league?.name}}</h1>
        <p class="text-xl text-gray-200 mb-8">
          Stay updated with live runs, match schedules and results from
          around the world
        </p>
        <div class="flex items-center gap-6">
          <div class="flex items-center gap-3 bg-white/10 backdrop-blur px-4 py-2 rounded-full" *ngIf="!(league?.teams?.length > 1)">
            <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
            <span class="text-white">No Teams Joined Yet</span>
          </div>

          <div class="flex whitespace-nowrap items-center gap-3 bg-white/10 backdrop-blur px-4 py-2 rounded-full cursor-pointer" (click)="copyToClipBoard()" *ngIf="league?.userId === user?.uid">
            <input type="text" value="{{league?.leagueCode}}" class="mt-1 hidden" id="copylink" style="width: 90%">
            <span class="text-white">Leguge Code: {{league?.leagueCode}}</span>
            <i class="ri-file-copy-line"></i>
          </div>

          <div class="whitespace-nowrap flex items-center gap-3 bg-white/10 backdrop-blur px-4 py-2 rounded-full cursor-pointer" *ngIf="league?.teams?.length > 1">
            <i class="ri-team-line mr-1"></i>
            <span class="text-white">Teams: {{league?.teams?.length}}</span>
          </div>

          <div class="whitespace-nowrap flex items-center gap-3 bg-white/10 backdrop-blur px-4 py-2 rounded-full cursor-pointer" *ngIf="league?.teams?.length > 1">
            <i class="ri-basketball-fill"></i>
            <span class="text-white">{{league?.oversMatch}} Overs Match</span>
          </div>

          <div class="whitespace-nowrap flex items-center gap-3 bg-white/10 backdrop-blur px-4 py-2 rounded-full cursor-pointer" *ngIf="allMatches?.length">
            <i class="ri-basketball-fill"></i>
            <span class="text-white"> Total {{allMatches?.length}} Matches</span>
          </div>

        </div>
      </div>
    </div>
  </div>


  <div class="league-menu mb-16" *ngIf="(league?.teams?.length > 1)">
    <ng-container *ngIf="allMatches?.length > 0">
      <button class="text-gray-900 font-medium hover:text-primary transition-colors" [class.active]="selectedTab === 'fixtures'" (click)="selectedTab = 'fixtures'"> Fixtures </button>
      <button class="text-gray-900 font-medium hover:text-primary transition-colors" [class.active]="selectedTab === 'point-table'"  (click)="selectedTab = 'point-table'; generatePointsTable();"> Point Tables </button>
      <button class="text-gray-900 font-medium hover:text-primary transition-colors" [class.active]="selectedTab === 'playoffs'" (click)="selectedTab = 'playoffs'; generatePlayOffs()" > PlayOffs </button>
    </ng-container>

    <ng-container *ngIf="!allMatches?.length && league?.userId === user?.uid">
      <button class="text-gray-900 font-medium hover:text-primary transition-colors" (click)="generateFixtures()"> 
        <span *ngIf="fixturesLoading"> 
          <app-spinner></app-spinner>
        </span>

        <span *ngIf="!fixturesLoading"> Generate Fixtures </span>
      </button>
    </ng-container>
  </div>

  <div class="max-w-7xl mx-auto px-8 pb-16" *ngIf="selectedTab === 'fixtures'">
    <div class="flex items-center justify-between mb-12" *ngIf="allMatches?.length > 0"> 
      <div class="flex items-center gap-8">
        <button class="text-gray-500 hover:text-primary transition-colors" [class.text-gray-900]="matchType === 'all'" [class.font-medium]="matchType === 'all'" (click)="setMatchType('all')">
          All Matches
        </button>
        <button class="text-gray-500 hover:text-primary transition-colors" [class.text-gray-900]="matchType === 'completed'" [class.font-medium]="matchType === 'completed'" (click)="setMatchType('completed')">
          Completed
        </button>
        <button class="text-gray-500 hover:text-primary transition-colors" [class.text-gray-900]="matchType === 'upcoming'" [class.font-medium]="matchType === 'upcoming'" (click)="setMatchType('upcoming')">
          Upcoming
        </button>
      </div>
      <div class="flex items-center gap-3">
        <div class="relative">
          <input type="text" placeholder="Search matches..." (input)="searchMatches($event)"
            class="pl-10 pr-4 py-2 rounded-full bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary/20 w-64" />
          <i class="ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
      </div>
    </div>
    <div class="grid grid-cols-1 gap-6" id="matchContainer">

      <ng-container *ngFor="let fixture of fixtures">
        <div
          class="match-card bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer overflow-hidden">
          <div class="relative">
            <div class="absolute top-4 right-4 flex items-center gap-2">
              <div class="flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full" *ngIf="fixture?.status === 'upcoming'">
                <i class="ri-time-line text-gray-600"></i>
                <span class="text-gray-600 font-medium">Upcoming</span>
              </div>

              <div class="flex items-center gap-2 bg-green-50 px-3 py-1 rounded-full" *ngIf="fixture?.status === 'completed'">
                <i class="ri-checkbox-circle-line text-green-600"></i>
                <span class="text-green-600 font-medium">Completed</span>
              </div>
            </div>

            <ng-container *ngIf="fixture?.status === 'completed'">
              <div *ngIf="fixture?.team_one?.runs > fixture?.team_two?.runs"
                class=" w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-1 px-6 text-center font-medium flex items-center justify-center gap-2">
                <i class="ri-trophy-line"></i>
                <span>{{fixture?.team_one?.name ?? getTeamDetails(fixture?.team_one)?.name}} Won The Match!</span>
              </div>

              <div *ngIf="fixture?.team_two?.runs > fixture?.team_one?.runs"
                class=" w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-1 px-6 text-center font-medium flex items-center justify-center gap-2">
                <i class="ri-trophy-line"></i>
                <span>{{fixture?.team_two?.name ?? getTeamDetails(fixture?.team_two)?.name}} Won The Match!</span>
              </div>
              
              <div *ngIf="fixture?.team_two?.runs === fixture?.team_one?.runs"
                class=" w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-1 px-6 text-center font-medium flex items-center justify-center gap-2">
                <i class="ri-trophy-line"></i>
                <span>{{fixture?.team_two?.name ?? getTeamDetails(fixture?.team_two)?.name}} Won The Match!</span>
              </div>

            </ng-container>


            <div class="p-6">
              <div class="flex items-center gap-2 mb-4">
                <i class="ri-trophy-line text-primary"></i>
                <span class="font-medium text-gray-900">{{league?.name}}: Match {{fixture?.match_number}}</span>
              </div>
              <div class="flex items-center justify-between mb-8">
                <div class="flex items-center gap-4 flex-1">
                  <img [src]="fixture?.team_one?.logo ?? getTeamDetails(fixture?.team_one)?.logo"
                    class="w-12 h-12 rounded-full object-cover" alt="New Zealand">
                  <div>
                    <div [routerLink]="['/stats', fixture?.team_one?.id]" class="team-name font-semibold text-lg text-gray-900">{{fixture?.team_one?.name ?? getTeamDetails(fixture?.team_one)?.name}}</div>
                    <div *ngIf="fixture?.status !== 'upcoming'" 
                      [class.text-red-500]="fixture?.team_two?.runs > fixture?.team_one?.runs" 
                      [class.text-green-500]="fixture?.team_one?.runs > fixture?.team_two?.runs" class="text-2xl font-bold text-gray-900">{{fixture?.team_one?.runs}}/{{fixture?.team_one?.wickets}}</div>
                    <div *ngIf="fixture?.status !== 'upcoming'"  class="text-sm text-gray-500">{{ballsToOvers(fixture?.team_one?.balls)}} overs</div>
                  </div>
                </div>
                <div class="px-6">
                  <div class="text-gray-400 font-medium text-lg mb-2">VS</div>
                </div>
                <div class="flex items-center gap-4 flex-1 justify-end">
                  <div class="text-right">
                    <div [routerLink]="['/stats', fixture?.team_two?.id]" class="team-name font-semibold text-lg text-gray-900">{{fixture?.team_two?.name ??  getTeamDetails(fixture?.team_two)?.name}}</div>
                    <div *ngIf="fixture?.status !== 'upcoming'" 
                      [class.text-red-500]="fixture?.team_one?.runs > fixture?.team_two?.runs" 
                      [class.text-green-500]="fixture?.team_two?.runs > fixture?.team_one?.runs"
                     class="text-2xl font-bold text-gray-900">{{fixture?.team_two?.runs}}/{{fixture?.team_two?.wickets}}</div>
                    <div *ngIf="fixture?.status !== 'upcoming'" class="text-sm text-gray-500">{{ballsToOvers(fixture?.team_two?.balls)}} overs</div>
                  </div>
                  <img [src]="fixture?.team_two?.logo ?? getTeamDetails(fixture?.team_two)?.logo"
                    class="w-12 h-12 rounded-full object-cover" alt="Pakistan">
                </div>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 text-gray-500">
                  <i class="ri-map-pin-line"></i>
                  <span>{{league?.venue}}</span>
                </div>
                
                <button class="outline-btn flex gap-2 items-center !border-red-200 hover:!bg-transparent" 
                *ngIf="(fixture?.status != 'completed') && ((league?.userId === user?.uid) || fixture?.team_two?.id === user?.uid || fixture?.team_one?.id === user?.uid)" (click)="openMatchResultModal(fixture)">
                  <img src="./assets/icons/cricket-ball.gif" alt="" width="30" width="30">
                  Update Result
                </button>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="!fixturesLoading && fixtures?.length === 0">
        <div class="flex items-center justify-center mt-10 w-full">
          <div class="text-gray-500 text-center">
            No Fixtures Found
          </div>
        </div>
      </ng-container>
    </div>
  </div>


  <div class="table-container overflow-x-auto shadow-lg rounded-lg" *ngIf="selectedTab === 'point-table'">
    <table class="w-full bg-white">
      <thead class="bg-white sticky top-0">
        <tr class="text-sm text-gray-700 font-semibold border-b">
          <th class="px-6 py-4 text-left">Team</th>
          <th class="px-4 py-4 text-center">P</th>
          <th class="px-4 py-4 text-center">W</th>
          <th class="px-4 py-4 text-center">L</th>
          <th class="px-4 py-4 text-center">D</th>
          <th class="px-4 py-4 text-center">RF</th>
          <th class="px-4 py-4 text-center">OF</th>
          <th class="px-4 py-4 text-center">RA</th>
          <th class="px-4 py-4 text-center">OB</th>
          <td class="px-4 py-4 text-center">Wkts</td>
          <th class="px-4 py-4 text-center">Pts</th>
          <th class="px-4 py-4 text-center">NRR</th>
          <th class="px-4 py-4 text-center">Win%</th>
        </tr>
      </thead>
      <tbody>
        <tr class="bg-gray-50 hover:bg-gray-100 transition-colors duration-200 cursor-pointer" *ngFor="let team of pointTable; let i = index"
        [class.!bg-white]="i % 2 === 0">
          <td class="px-6 py-4">
            <div class="flex items-center gap-3">
              <img
                [src]="team?.team_logo"
                alt="Royal Challengers"
                class="w-8 h-8 rounded-full object-cover"
              />
              <span class="font-semibold text-gray-900">{{team?.team}}</span>
              <img src="/assets/icons/orangecap.png" alt="" width="30" height="30" *ngIf="team?.id === orangecap?.id">
              <img src="/assets/icons/purplecap.png" alt="" width="30" height="30" *ngIf="team?.id === purplecap?.id">
            </div>
          </td>
          <td class="px-4 py-4 text-center">{{team?.played}}</td>
          <td class="px-4 py-4 text-center text-green-600 font-medium">{{team?.win}}</td>
          <td class="px-4 py-4 text-center text-red-600 font-medium">{{team?.loss}}</td>
          <td class="px-4 py-4 text-center">{{team?.draw}}</td>
          <td class="px-4 py-4 text-center">{{team?.runsFor}}</td>
          <td class="px-4 py-4 text-center">{{team?.oversFaced}}</td>
          <td class="px-4 py-4 text-center">{{team?.runsAgainst}}</td>
          <td class="px-4 py-4 text-center">{{team?.oversBowled}}</td>
          <td class="px-4 py-4 text-center">{{team?.wicketsTaken}}</td>
          <td class="px-4 py-4 text-center font-semibold">{{team?.pts}}</td>
          <td class="px-4 py-4 text-center"
          [class.text-green-600]="+(team?.nrr) > 0"
          [class.text-red-600]="0 > +(team?.nrr)"
          >{{team?.nrr}}</td>
          <td class="px-4 py-4 text-center">{{team?.winPercentage}}</td>
        </tr>

      </tbody>
    </table>
  </div>

  <div class="grid grid-cols-1 gap-6" id="matchContainer"*ngIf="selectedTab === 'playoffs' && !isPlayOffLoading">
    <ng-container *ngFor="let fixture of playOffs">
      <div
        class="match-card mb-4 bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer overflow-hidden">
        <div class="relative">
          <div class="absolute top-4 right-4 flex items-center gap-2">
            <div class="flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full" *ngIf="fixture?.status === 'upcoming'">
              <i class="ri-time-line text-gray-600"></i>
              <span class="text-gray-600 font-medium">Upcoming</span>
            </div>

            <div class="flex items-center gap-2 bg-green-50 px-3 py-1 rounded-full" *ngIf="fixture?.status === 'completed'">
              <i class="ri-checkbox-circle-line text-green-600"></i>
              <span class="text-green-600 font-medium">Completed</span>
            </div>
          </div>

          <ng-container *ngIf="fixture?.status === 'completed'">
            <div *ngIf="fixture?.team_one?.runs > fixture?.team_two?.runs"
              class=" w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-1 px-6 text-center font-medium flex items-center justify-center gap-2">
              <i class="ri-trophy-line"></i>
              <span>{{fixture?.team_one?.name ?? getTeamDetails(fixture?.team_one)?.name}} Won The Match!</span>
            </div>

            <div *ngIf="fixture?.team_two?.runs > fixture?.team_one?.runs"
              class=" w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-1 px-6 text-center font-medium flex items-center justify-center gap-2">
              <i class="ri-trophy-line"></i>
              <span>{{fixture?.team_two?.name ?? getTeamDetails(fixture?.team_two)?.name}} Won The Match!</span>
            </div>
            
            <div *ngIf="fixture?.team_two?.runs === fixture?.team_one?.runs"
              class=" w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-1 px-6 text-center font-medium flex items-center justify-center gap-2">
              <i class="ri-trophy-line"></i>
              <span>{{fixture?.team_two?.name ?? getTeamDetails(fixture?.team_two)?.name}} Won The Match!</span>
            </div>

          </ng-container>


          <div class="p-6">
            <div class="flex items-center gap-2 mb-4">
              <i class="ri-trophy-line text-primary"></i>
              <span class="font-medium text-gray-900">{{league?.name}}: Match {{fixture?.match_number}}</span>
            </div>
            <div class="flex items-center justify-between mb-8">
              <div class="flex items-center gap-4 flex-1">
                <img [src]="fixture?.team_one?.logo ?? getTeamDetails(fixture?.team_one)?.logo"
                  class="w-12 h-12 rounded-full object-cover" alt="New Zealand">
                <div>
                  <div [routerLink]="['/stats', fixture?.team_one?.id]" class="team-name font-semibold text-lg text-gray-900">{{fixture?.team_one?.name ?? getTeamDetails(fixture?.team_one)?.name}}</div>
                  <div *ngIf="fixture?.status !== 'upcoming'" 
                    [class.text-red-500]="fixture?.team_two?.runs > fixture?.team_one?.runs" 
                    [class.text-green-500]="fixture?.team_one?.runs > fixture?.team_two?.runs" class="text-2xl font-bold text-gray-900">{{fixture?.team_one?.runs}}/{{fixture?.team_one?.wickets}}</div>
                  <div *ngIf="fixture?.status !== 'upcoming'"  class="text-sm text-gray-500">{{ballsToOvers(fixture?.team_one?.balls)}} overs</div>
                </div>
              </div>
              <div class="px-6">
                <div class="text-gray-400 font-medium text-lg mb-2">VS</div>
              </div>
              <div class="flex items-center gap-4 flex-1 justify-end">
                <div class="text-right">
                  <div [routerLink]="['/stats', fixture?.team_two?.id]" class="team-name font-semibold text-lg text-gray-900">{{fixture?.team_two?.name ??  getTeamDetails(fixture?.team_two)?.name}}</div>
                  <div *ngIf="fixture?.status !== 'upcoming'" 
                    [class.text-red-500]="fixture?.team_one?.runs > fixture?.team_two?.runs" 
                    [class.text-green-500]="fixture?.team_two?.runs > fixture?.team_one?.runs"
                   class="text-2xl font-bold text-gray-900">{{fixture?.team_two?.runs}}/{{fixture?.team_two?.wickets}}</div>
                  <div *ngIf="fixture?.status !== 'upcoming'" class="text-sm text-gray-500">{{ballsToOvers(fixture?.team_two?.balls)}} overs</div>
                </div>
                <img [src]="fixture?.team_two?.logo ?? getTeamDetails(fixture?.team_two)?.logo"
                  class="w-12 h-12 rounded-full object-cover" alt="Pakistan">
              </div>
            </div>
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2 text-gray-500">
                <i class="ri-map-pin-line"></i>
                <span>{{league?.venue}}</span>
              </div>
              
              <button class="outline-btn flex gap-2 items-center !border-red-200 hover:!bg-transparent" 
              *ngIf="(fixture?.status != 'completed') && ((league?.userId === user?.uid) || fixture?.team_two?.id === user?.uid || fixture?.team_one?.id === user?.uid)" (click)="openMatchResultModal(fixture)">
                <img src="./assets/icons/cricket-ball.gif" alt="" width="30" width="30">
                Update Result
              </button>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <ng-container *ngIf="fixturesLoading || isPlayOffLoading">
    <app-spinner></app-spinner> 
  </ng-container>
</div>

  <p-dialog header="Match Result" [(visible)]="matchResultModal" [modal]="true" [draggable]="false" [resizable]="false">
    <app-match-result [match]="selectedMatch" (closeMatchResultModal)="closeMatchResultModal($event)"></app-match-result>
 </p-dialog>

<div class="mdc-snackbar"><div class="mdc-snackbar__surface"><div class="mdc-snackbar__label" role="status" aria-live="polite">Copied!</div><div class="mdc-snackbar__actions">
